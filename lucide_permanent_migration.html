<!-- 
  ISTRUZIONI:
  1. RIMUOVERE questa riga dall'HTML:
     <script src="https://cdn.jsdelivr.net/npm/lucide@0.263.1/dist/umd/lucide.min.js"></script>
  
  2. AGGIUNGERE nel <head> (PRIMA di altri script):
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3H5V+KaQn84xXtXmrWEKpqjuhCs2vIaWjmJ2qnyRn016pwIxgJ6imASSssnEUvUAndBapQ/J8BwA==" crossorigin="anonymous">
  
  3. AGGIUNGERE QUESTO SCRIPT nel <head>, PRIMA di qualsiasi altro script:
-->

<script>
// ============================================
// BLOCCO LUCIDE E MIGRAZIONE PERMANENTE
// ============================================
// Esegui IMMEDIATAMENTE prima del caricamento di altri script

(function() {
  'use strict';
  
  console.log('🔄 [MIGRAZIONE] Inizio migrazione Lucide → Font Awesome');
  
  // ============================================
  // STEP 1: Blocca Lucide prima che si carichi
  // ============================================
  
  // Sostituisci l'oggetto lucide con un dummy
  window.lucide = {
    createIcons: function() {
      console.log('✅ [BLOCCO] lucide.createIcons() è stata disabilitata');
      return;
    },
    // Aggiungi altri metodi che potrebbero essere usati
    set: function() { return; },
    watch: function() { return; },
    icons: {}
  };
  
  console.log('✅ [BLOCCO] Lucide è stato bloccato');
  
  // ============================================
  // STEP 2: MAPPING ICONE LUCIDE → FONT AWESOME
  // ============================================
  
  const iconMappings = {
    // Navigation & UI
    'filter': 'fas fa-filter',
    'sliders-horizontal': 'fas fa-sliders',
    'chevron-down': 'fas fa-chevron-down',
    'chevron-up': 'fas fa-chevron-up',
    'x': 'fas fa-xmark',
    'xmark': 'fas fa-xmark',
    'refresh-cw': 'fas fa-arrows-rotate',
    'info': 'fas fa-circle-info',
    'help-circle': 'fas fa-circle-question',
    'arrow-up': 'fas fa-arrow-up',
    'arrow-down': 'fas fa-arrow-down',
    'arrow-left': 'fas fa-arrow-left',
    'arrow-right': 'fas fa-arrow-right',
    'search': 'fas fa-magnifying-glass',
    'menu': 'fas fa-bars',
    'expand': 'fas fa-expand',
    'minimize': 'fas fa-minimize',
    
    // Maps & Location
    'map': 'fas fa-map',
    'map-pin': 'fas fa-location-dot',
    'layers': 'fas fa-layer-group',
    'home': 'fas fa-house',
    'navigation': 'fas fa-compass',
    'route': 'fas fa-road',
    
    // File & Document
    'file-text': 'fas fa-file-lines',
    'file-down': 'fas fa-file-download',
    'download': 'fas fa-download',
    'external-link': 'fas fa-arrow-up-right-from-square',
    'file-check': 'fas fa-file-check',
    'clipboard-list': 'fas fa-clipboard-list',
    'document': 'fas fa-document',
    
    // Media & Images
    'image': 'fas fa-image',
    'photo': 'fas fa-photo-film',
    'video': 'fas fa-video',
    
    // Charts & Analytics
    'bar-chart-3': 'fas fa-chart-bar',
    'bar-chart-4': 'fas fa-chart-bar',
    'pie-chart': 'fas fa-chart-pie',
    'trending-up': 'fas fa-arrow-trend-up',
    'activity': 'fas fa-chart-line',
    'table': 'fas fa-table',
    
    // Users & People
    'user': 'fas fa-user',
    'user-check': 'fas fa-user-check',
    'users': 'fas fa-people-group',
    'users-2': 'fas fa-people-group',
    'user-plus': 'fas fa-user-plus',
    
    // Organization & Places
    'building-2': 'fas fa-building',
    'landmark': 'fas fa-gopuram',
    
    // Actions & Status
    'target': 'fas fa-bullseye',
    'check': 'fas fa-check',
    'alert-circle': 'fas fa-circle-exclamation',
    'pen-tool': 'fas fa-pen-fancy',
    'zap': 'fas fa-bolt',
    'star': 'fas fa-star',
    'bell': 'fas fa-bell',
    
    // Content & Communication
    'message-circle': 'fas fa-message',
    'comment': 'fas fa-comment',
    'heart': 'fas fa-heart',
    'heart-handshake': 'fas fa-handshake',
    'share': 'fas fa-share-nodes',
    'mail': 'fas fa-envelope',
    'phone': 'fas fa-phone',
    'rss': 'fas fa-rss',
    
    // Governance & Rules
    'scale': 'fas fa-balance-scale',
    'book-open': 'fas fa-book',
    'book-marked': 'fas fa-bookmark',
    'book-user': 'fas fa-book-open-reader',
    
    // Social Media
    'twitter': 'fab fa-twitter',
    'facebook': 'fab fa-facebook',
    'instagram': 'fab fa-instagram',
    'youtube': 'fab fa-youtube',
    'linkedin': 'fab fa-linkedin',
    
    // Eye & Visibility
    'eye': 'fas fa-eye',
    'eye-off': 'fas fa-eye-slash',
    
    // Settings & Configuration
    'settings': 'fas fa-gear',
    'network': 'fas fa-network-wired',
    'tool': 'fas fa-wrench',
    
    // Rocket & Development
    'rocket': 'fas fa-rocket',
    'code': 'fas fa-code',
    'git-branch': 'fas fa-code-branch',
    
    // Time & Calendar
    'calendar': 'fas fa-calendar',
    'clock': 'fas fa-clock',
    'history': 'fas fa-history',
    
    // Common Utilities
    'layout': 'fas fa-rectangle-landscape',
    'grid': 'fas fa-grip',
    'list': 'fas fa-list',
    'more-vertical': 'fas fa-ellipsis-vertical',
    'more-horizontal': 'fas fa-ellipsis',
    'lightbulb': 'fas fa-lightbulb',
    'lock': 'fas fa-lock',
    'unlock': 'fas fa-unlock',
    'trash': 'fas fa-trash',
    'edit': 'fas fa-pen',
    'plus': 'fas fa-plus',
    'minus': 'fas fa-minus',
    'close': 'fas fa-times',
    'circle': 'fas fa-circle',
    'sliders': 'fas fa-sliders',
    'eye-open': 'fas fa-eye',
    'chevron': 'fas fa-chevron-right'
  };
  
  // ============================================
  // STEP 3: FUNZIONE MIGRAZIONE AUTO
  // ============================================
  
  function performMigration() {
    console.log('🔄 [MIGRAZIONE] Ricerca elementi con data-lucide...');
    
    const elements = document.querySelectorAll('[data-lucide]');
    console.log(`📊 [MIGRAZIONE] Trovati ${elements.length} elementi`);
    
    let replaced = 0;
    let notFound = 0;
    const notFoundIcons = new Set();
    
    elements.forEach((element) => {
      const lucideIcon = element.getAttribute('data-lucide');
      const faClass = iconMappings[lucideIcon];
      
      if (faClass) {
        // Crea nuovo elemento i con Font Awesome
        const newElement = document.createElement('i');
        newElement.className = faClass;
        
        // Copia aria-hidden se esiste
        if (element.hasAttribute('aria-hidden')) {
          newElement.setAttribute('aria-hidden', element.getAttribute('aria-hidden'));
        }
        
        // Copia altre classi di styling (h-4, w-4, ecc)
        const classesToKeep = element.className
          .split(' ')
          .filter(c => c.match(/^(h-|w-|text-|mx-|my-|mb-|mt-|ml-|mr-|px-|py-|p-|opacity-|transform|scale|rotate)/));
        
        if (classesToKeep.length > 0) {
          newElement.className += ' ' + classesToKeep.join(' ');
        }
        
        // Copia attributi di stile inline
        if (element.style.cssText) {
          newElement.style.cssText = element.style.cssText;
        }
        
        // Rimpiazza elemento
        element.parentNode.replaceChild(newElement, element);
        replaced++;
      } else {
        notFound++;
        notFoundIcons.add(lucideIcon);
      }
    });
    
    console.log(`✅ [MIGRAZIONE] Completata - Sostituiti: ${replaced}, Non trovati: ${notFound}`);
    
    if (notFoundIcons.size > 0) {
      console.warn('⚠️  [MIGRAZIONE] Icone non mappate:');
      notFoundIcons.forEach(icon => {
        console.warn(`   - ${icon}`);
      });
    }
    
    return { replaced, notFound, notFoundIcons: Array.from(notFoundIcons) };
  }
  
  // ============================================
  // STEP 4: ESECUZIONE STRATEGICA
  // ============================================
  
  // Opzione A: Se il DOM è già pronto
  if (document.readyState === 'loading') {
    // Il DOM non è ancora caricato
    document.addEventListener('DOMContentLoaded', function() {
      console.log('📄 [MIGRAZIONE] DOMContentLoaded - Esecuzione migrazione...');
      performMigration();
    });
  } else {
    // Il DOM è già caricato
    console.log('📄 [MIGRAZIONE] DOM già caricato - Esecuzione migrazione...');
    performMigration();
  }
  
  // Opzione B: Esegui anche su MutationObserver per elementi dinamici
  const observer = new MutationObserver((mutations) => {
    const hasNewLucideIcons = mutations.some(mutation => {
      return Array.from(mutation.addedNodes).some(node => 
        node.nodeType === 1 && (
          node.hasAttribute('data-lucide') || 
          node.querySelector('[data-lucide]')
        )
      );
    });
    
    if (hasNewLucideIcons) {
      console.log('🔄 [MIGRAZIONE] Nuovi elementi rilevati - Esecuzione migrazione...');
      setTimeout(() => performMigration(), 100);
    }
  });
  
  observer.observe(document.body, {
    childList: true,
    subtree: true
  });
  
  // Esponi funzioni globali per debug
  window.lucideMigrationStatus = function() {
    console.log('📊 [MIGRAZIONE] Status Report');
    console.log(`Icone mappate: ${Object.keys(iconMappings).length}`);
    console.log(`Elementi data-lucide rimanenti: ${document.querySelectorAll('[data-lucide]').length}`);
  };
  
  window.lucideMigrationDebug = function() {
    console.table(iconMappings);
  };
  
  console.log('✅ [MIGRAZIONE] Script caricato e attivo');
  console.log('💡 Comandi disponibili:');
  console.log('   lucideMigrationStatus()  - Visualizza status');
  console.log('   lucideMigrationDebug()   - Visualizza mappature');
  
})();
</script>

<!-- 
  PLACEMENT NEL FILE HTML:
  
  Posizionare ESATTAMENTE come segue:
  
  <!DOCTYPE html>
  <html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Font Awesome CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3H5V+KaQn84xXtXmrWEKpqjuhCs2vIaWjmJ2qnyRn016pwIxgJ6imASSssnEUvUAndBapQ/J8BwA==" crossorigin="anonymous">
    
    <!-- QUESTO SCRIPT (MIGRAZIONE) - DEVE ESSERE QUI, PRIMO DI TUTTO -->
    <script>
      (function() {
        // ... codice migrazione ...
      })();
    </script>
    
    <!-- ALTRI LINK STYLESHEET -->
    <link rel="stylesheet" href="css/v5/patti_pa_general.css">
    <!-- ... altri link ... -->
    
  </head>
  <body>
    <!-- CONTENUTO -->
    
    <!-- ALTRI SCRIPT - DOPO IL CORPO -->
    <script src="js/v5/monitoraggio_p1-v2.js"></script>
    <!-- ... altri script ... -->
  </body>
  </html>
-->